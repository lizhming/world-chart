webpackJsonp([0],{130:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),i=n(240),s=n(59),a=n(26),r=(n.n(a),n(9)),c=n(248),l=n(72),A=n(73),u=n(58),g=n(249),d=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o){var r=this;this.modalCtrl=e,this.navCtrl=t,this.toastCtrl=n,this.barcodeScanner=o,this.tab1Root=g.a,this.tab2Root=i.a,this.tab3Root=s.a;var l=JSON.parse(localStorage.getItem("user"));if(this.user=l,l.complete){if(l&&!l.thumb){a.storage().ref("users").child(l.$id).child("thumb.jpg").putString("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","base64").then(function(e){a.storage().ref("users").child(l.$id).child("thumb.jpg").getDownloadURL().then(function(e){l.thumb=e,a.firestore().collection("users").doc(l.$id).update(l),localStorage.setItem("user",JSON.stringify(l))})})}}else{var A=this.modalCtrl.create(c.a);A.onDidDismiss(function(e){l=e}),A.present()}a.firestore().collection("users").doc(l.$id).collection("tempConversations").onSnapshot(function(e){e.forEach(function(e){a.firestore().collection("tempConversations").doc(e.data().chatId).get().then(function(e){r.viewConversation(e.data(),!0)})})})}return e.prototype.addTempChat=function(){var e=this;this.barcodeScanner.scan({prompt:"Scan a Profile Code"}).then(function(t){"QR_CODE"==t.format&&a.firestore().collection("users").where("$id","==",t.text).get().then(function(t){if(!t.docs.length){e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}t.forEach(function(t){if(t.data()){var n=t.data(),o=a.firestore().collection("tempConversations").doc();a.firestore().collection("users").doc(e.user.$id).collection("tempConversations").doc(o.id).set({chatId:o.id}),a.firestore().collection("users").doc(n.$id).collection("tempConversations").doc(o.id).set({chatId:o.id});var i={$id:o.id,users:[{$id:e.user.$id,username:e.user.username,firstName:e.user.firstName||"",lastName:e.user.lastName||"",language:e.user.language},{$id:n.$id,username:n.username,firstName:n.firstName||"",lastName:n.lastName||"",language:n.language}],languages:[e.user.language,n.language],readBy:{}};i.readBy[e.user.$id]=e.user.username,a.firestore().collection("conversations").doc(o.id).set(i),e.viewConversation(i,!0)}else{e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})})})},e.prototype.viewConversation=function(e,t){void 0===t&&(t=!1),this.navCtrl.push(t?A.a:u.a,{conversation:e})},e=d([Object(o.Component)({template:'<ion-tabs>\n  \x3c!--<ion-tab [root]="tab1Root" tabTitle="My Status" tabIcon="home"></ion-tab>--\x3e\n  <ion-tab [root]="tab2Root" tabTitle="Chats" tabIcon="chatboxes"></ion-tab>\n  <ion-tab [root]="tab1Root" tabTitle="Temp Chat" tabIcon="thunderstorm"></ion-tab>\n  <ion-tab [root]="tab3Root" tabTitle="Profile" tabIcon="contacts"></ion-tab>\n</ion-tabs>\n'}),h("design:paramtypes",[r.q,r.r,r.w,l.a])],e)}()},136:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),i=n(9),s=n(26),a=(n.n(s),n(130)),r=n(32),c=(n.n(r),n(40)),l=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n,o,i,a){var r=this;this.navCtrl=e,this.navParams=t,this.alertCtrl=n,this.loadingCtrl=o,this.http=i,this.toastCtrl=a,this.language=[],this.mode="login",this.emailOrPhone="email",this.GetLanguage().subscribe(function(e){r.language=e}),JSON.parse(localStorage.getItem("isBrowser"))||(this.emailOrPhone="phone"),console.log(this.emailOrPhone),s.firestore().collection("hello").doc(Date.now()+"").set({data:this.emailOrPhone})}return e.prototype.signIn=function(e,t,n){var o=this;if((e||t)&&n)this.loading=this.loadingCtrl.create({content:"Please wait..."}),this.loading.present(),"email"===this.emailOrPhone?(s.firestore().collection("hello").doc(Date.now()+"").set({data:"inside email if"}),s.firestore().collection("emailAuths").doc(e).get().then(function(e){if(e.data())if(e.data().password==n)s.firestore().collection("users").doc(e.data().$id).get().then(function(e){localStorage.setItem("user",JSON.stringify(e.data())),setTimeout(function(){o.navCtrl.setRoot(a.a)},100)});else{o.alertCtrl.create({title:"Email or password invalid",buttons:["Try again"]}).present()}}).catch(function(e){s.firestore().collection("hello").doc(Date.now()+"").set({data:JSON.stringify(e)})})):(s.firestore().collection("hello").doc(Date.now()+"").set({data:"inside phone if"}),s.firestore().collection("phoneAuths").doc(t).get().then(function(e){if(e.data())if(e.data().password==n)s.firestore().collection("users").doc(e.data().$id).get().then(function(e){localStorage.setItem("user",JSON.stringify(e.data())),setTimeout(function(){o.navCtrl.setRoot(a.a)},100)});else{o.alertCtrl.create({title:"Phone or password invalid",buttons:["Try again"]}).present()}}).catch(function(e){s.firestore().collection("hello").doc(Date.now()+"").set({data:JSON.stringify(e)})})),this.loading.dismiss();else{this.alertCtrl.create({title:"Please Enter an (Email or Phone Number) and a password",buttons:["Dismiss"]}).present()}},e.prototype.register=function(e,t,n,o,i,r){var c=this,l=this.loadingCtrl.create({content:"Please wait..."});l.present();var A=[],u=[new Promise(function(t,n){s.firestore().collection("users").where("fullPhone","==","+"+e).get().then(function(e){e.forEach(function(e){A.push(e)}),t()})}),new Promise(function(e,n){s.firestore().collection("users").where("phone","==",t).get().then(function(t){t.forEach(function(e){A.push(e)}),e()})}),new Promise(function(e,t){s.firestore().collection("users").where("email","==","+"+n).get().then(function(t){t.forEach(function(e){A.push(e)}),e()})})];Promise.all(u).then(function(u){if(l.dismiss(),A.length){c.toastCtrl.create({message:"The email or phone number is already registered.",duration:3e3,position:"bottom"}).present()}else{var g=s.firestore().collection("users").doc();s.firestore().collection("users").doc(g.id).set({$id:g.id,phone:t,fullPhone:e,email:n}),s.firestore().collection("phoneAuths").doc(t).get().then(function(e){e.data()||s.firestore().collection("phoneAuths").doc(t).set({$id:g.id,password:o})}),s.firestore().collection("emailAuths").doc(n).get().then(function(e){e.data()||s.firestore().collection("emailAuths").doc(n).set({$id:g.id,password:o})}),localStorage.setItem("user",JSON.stringify({$id:g.id,email:n,phone:t,fullPhone:e,firstName:i,lastName:r})),setTimeout(function(){c.navCtrl.setRoot(a.a)},100)}})},e.prototype.verifyCode=function(e){var t=this;this.loading=this.loadingCtrl.create({content:"Please wait..."}),this.loading.present();var n=s.auth.PhoneAuthProvider.credential(this.verificationId,e);s.auth().signInWithCredential(n).then(function(e){t.loading.dismiss(),t.doLogin()})},e.prototype.showPrompt=function(){var e=this;this.loading.dismiss();this.alertCtrl.create({title:"Enter the Confirmation code",inputs:[{name:"code",placeholder:"Code"}],buttons:[{text:"Cancel",handler:function(e){}},{text:"Verify",handler:function(t){e.verifyCode(t.code)}}]}).present()},e.prototype.doLogin=function(){var e=this;setTimeout(function(){e.navCtrl.setRoot(a.a)},100)},e.prototype.slideChanged=function(){this.slides.isEnd()},e.prototype.GetLanguage=function(){return this.http.get("./assets/language/language.json").pipe(Object(r.map)(function(e){return e.array}))},l([Object(o.ViewChild)(i.v),A("design:type",i.v)],e.prototype,"slides",void 0),e=l([Object(o.Component)({selector:"page-login",template:'\x3c!--\n  Generated template for the LoginPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n\x3c!--<ion-header>--\x3e\n\n  \x3c!--<ion-navbar>--\x3e\n    \x3c!--<ion-title>Login</ion-title>--\x3e\n  \x3c!--</ion-navbar>--\x3e\n\n\x3c!--</ion-header>--\x3e\n\n<ion-content padding>\n\n  <div style="margin: 0px auto; display: block;" col-xs-12 col-md-6 col-lg-4>\n\n    <span *ngIf="mode !== \'login\'">\n      <p>International Phone Number</p>\n      <int-phone-prefix defaultCountry="us" [(ngModel)]="phoneNumber"></int-phone-prefix>\n      <p>Local Phone Number</p>\n    </span>\n    <ion-grid *ngIf="mode == \'login\'">\n\n      <img src="assets/imgs/logo.png" class="logo" />\n\n      \x3c!--<h1 style="width: 100%; text-align: center;">Login with:</h1>--\x3e\n      <ion-list radio-group [(ngModel)]="emailOrPhone" class="emailOrPhone" col-5 col-xl-12 col-sm-12>\n        <ion-item style="display: inline-block;">\n          <ion-label>Email</ion-label>\n          <ion-radio value="email" [checked]="emailOrPhone === \'email\'"></ion-radio>\n        </ion-item>\n        <ion-item style="display: inline-block;">\n          <ion-label>Phone</ion-label>\n          <ion-radio value="phone" [checked]="emailOrPhone === \'phone\'"></ion-radio>\n        </ion-item>\n      </ion-list>\n\n      <ion-input type="number" class="input" placeholder="Phone" [style.display]="emailOrPhone === \'phone\' ? \'block\' : \'none\'" [(ngModel)]="phone"></ion-input>\n      <ion-input type="email" class="input" placeholder="Email" [style.display]="emailOrPhone === \'email\' ? \'block\' : \'none\'" [(ngModel)]="email"></ion-input>\n      <ion-input type="password" class="input" placeholder="Password" [(ngModel)]="password" (keyup.enter)="signIn(email, phone, password)"></ion-input>\n    </ion-grid>\n    <span *ngIf="mode !== \'login\'">\n      <ion-input type="number" class="input" placeholder="Phone" [(ngModel)]="phone" (keyup)="phoneNumber = phone"></ion-input>\n      <ion-input type="email" class="input" placeholder="Email" [(ngModel)]="email"></ion-input>\n      <ion-input type="password" class="input" placeholder="Password" [(ngModel)]="password"></ion-input>\n      <ion-input type="text" class="input" placeholder="First Name" [(ngModel)]="firstname"></ion-input>\n      <ion-input type="text" class="input" placeholder="Last Name" [(ngModel)]="lastname"></ion-input>\n    </span>\n    <br/>\n    <div text-center *ngIf="mode === \'login\'">\n      <button text-center ion-button clear (click)="signIn(email, phone, password)">Login</button>\n      <ion-label stacked>OR</ion-label>\n      <button text-center ion-button clear (click)="mode = \'register\'">Register</button>\n    </div>\n\n    <div text-center *ngIf="mode !== \'login\'">\n      <button text-center ion-button clear (click)="register(phoneNumber, phone, email, password, firstname, lastname)">Register</button>\n      <ion-label stacked>OR</ion-label>\n      <button text-center ion-button clear (click)="mode = \'login\'">Login</button>\n    </div>\n\n  </div>\n\n</ion-content>\n'}),A("design:paramtypes",[i.r,i.s,i.b,i.p,c.a,i.w])],e)}()},153:function(e,t){function n(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=153},196:function(e,t){function n(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=196},240:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),i=n(9),s=n(58),a=n(60),r=n(26),c=(n.n(r),n(246)),l=n(137),A=n(72),u=n(73),g=n(59),d=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,r)}c((o=o.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,i=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){r=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){r.label=n[1];break}if(6===n[0]&&r.label<s[1]){r.label=s[1],s=n;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(n);break}s[2]&&r.ops.pop(),r.trys.pop();continue}n=t.call(e,r)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var o,i,s,a,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},m=function(){function e(e,t,n,o,i,s,a,r,c){var l=this;this.navCtrl=e,this.modalCtrl=t,this.alertCtrl=n,this.toastCtrl=o,this.loadingCtrl=i,this.sms=s,this.barcodeScanner=a,this.ngZone=r,this.platform=c,this.searchQuery="",this.chats=[],this.hasLoadedChats=!1,this.isBrowser=!1,this.isBrowser=JSON.parse(localStorage.getItem("isBrowser")),this.ngZone.run(function(){l.user=JSON.parse(localStorage.getItem("user"))})}return e.prototype.ionViewWillEnter=function(){var e=this;this.ngZone.run(function(){e.user=JSON.parse(localStorage.getItem("user"))})},e.prototype.ionViewDidLoad=function(){this.initializeItems()},e.prototype.initializeItems=function(){var e=this,t=!0,n=this.loadingCtrl.create({content:"Gathering messages.."});n.present(),r.firestore().collection("users").doc(this.user.$id).collection("conversations").onSnapshot(function(o){o.docChanges().forEach(function(t){"added"===t.type&&r.firestore().collection("conversations").doc(t.doc.data().chatId).onSnapshot(function(t){var n=!1;e.chats.forEach(function(o,i){o&&t.data()&&o.$id===t.data().$id&&(n=!0,e.chats.splice(i,1),e.addToChats(t.data()))}),n||(e.addToChats(t.data()),e.hasLoadedChats||(e.hasLoadedChats=!0))}),"removed"===t.type&&e.chats.forEach(function(n,o){n&&t.doc.data()&&n.$id===t.doc.data().chatId&&e.chats.splice(o,1)})}),t&&(t=!1,n.dismiss())})},e.prototype.addToChats=function(e){return f(this,void 0,void 0,function(){var t,n=this;return p(this,function(o){return e?(e&&e.users&&e.users.forEach(function(o,i){return f(n,void 0,void 0,function(){return p(this,function(n){switch(n.label){case 0:return[4,r.firestore().collection("users").doc(o.$id).get()];case 1:return t=n.sent(),e.users[i].firstName=t.data().firstName||null,e.users[i].lastName=t.data().lastName||null,e.users[i].thumb=t.data().thumb||"",[2]}})})}),this.ngZone.run(function(){n.chats.unshift(e),n.chats=n.chats.sort(function(e,t){return e.lastMessage||(e.lastMessage={time:Date.now()}),t.lastMessage||(t.lastMessage={time:Date.now()}),t.lastMessage.time-e.lastMessage.time})}),[2]):[2]})})},e.prototype.isEquivalent=function(e,t){var n=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(n.length!=o.length)return!1;for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!==t[s])return!1}return!0},e.prototype.newConversation=function(e){var t=r.firestore().collection("conversations").doc();r.firestore().collection("users").doc(this.user.$id).collection("conversations").doc(t.id).set({chatId:t.id}),r.firestore().collection("users").doc(e.$id).collection("conversations").doc(t.id).set({chatId:t.id});var n={$id:t.id,users:[{$id:this.user.$id,username:this.user.username,firstName:this.user.firstName||"",lastName:this.user.lastName||"",language:this.user.language},{$id:e.$id,username:e.username,firstName:e.firstName||"",lastName:e.lastName||"",language:e.language}],languages:[this.user.language,e.language],readBy:{}};n.readBy[this.user.$id]=this.user.username,r.firestore().collection("conversations").doc(t.id).set(n),this.viewConversation(n)},e.prototype.viewConversation=function(e,t){void 0===t&&(t=!1),this.selectedConversation=null,this.isBrowser?this.selectedConversation=e:this.navCtrl.push(t?u.a:s.a,{conversation:e})},e.prototype.addByGroupChat=function(e){e.close(),this.navCtrl.push(c.a)},e.prototype.addByUsername=function(e){var t=this;e.close();this.alertCtrl.create({title:"Start a conversation",inputs:[{name:"username",placeholder:"Enter Username"}],buttons:[{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}},{text:"Add",handler:function(e){if(e.username)if(e.username!=t.user.username)r.firestore().collection("users").where("username","==",e.username.toLowerCase()).get().then(function(e){if(!e.docs.length){t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}e.forEach(function(e){if(e.data())t.newConversation(e.data());else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})});else{t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}}}]}).present()},e.prototype.addByContacts=function(e){var t=this;e.close();var n=this.modalCtrl.create(a.a);n.onDidDismiss(function(e){if(e){if(e==t.user.phone){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}var n=t.loadingCtrl.create({content:"Searching for user..."});n.present();var o=[],i=[new Promise(function(t,n){r.firestore().collection("users").where("fullPhone","==","+"+e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})}),new Promise(function(t,n){r.firestore().collection("users").where("phone","==",e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})})];Promise.all(i).then(function(i){if(n.dismiss(),o.length)o.forEach(function(e){if(e.data()){if(e.data().username==t.user.username){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}t.newConversation(e.data())}else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}});else{t.sms.send(e.toString()+" ",(t.user.firstName||t.user.username)+" invited you to download World Chat! Android: https://play.google.com/store/apps/details?id=com.letschat.mobile");t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})}}),n.present()},e.prototype.addTempChat=function(){var e=this;this.barcodeScanner.scan({prompt:"Scan a Profile Code"}).then(function(t){"QR_CODE"==t.format&&r.firestore().collection("users").where("$id","==",t.text).get().then(function(t){if(!t.docs.length){e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}t.forEach(function(t){if(t.data()){var n=t.data(),o=r.firestore().collection("tempConversations").doc();r.firestore().collection("users").doc(e.user.$id).collection("tempConversations").doc(o.id).set({chatId:o.id}),r.firestore().collection("users").doc(n.$id).collection("tempConversations").doc(o.id).set({chatId:o.id});var i={$id:o.id,users:[{$id:e.user.$id,username:e.user.username,firstName:e.user.firstName||"",lastName:e.user.lastName||"",language:e.user.language},{$id:n.$id,username:n.username,firstName:n.firstName||"",lastName:n.lastName||"",language:n.language}],languages:[e.user.language,n.language],readBy:{}};i.readBy[e.user.$id]=e.user.username,r.firestore().collection("conversations").doc(o.id).set(i),e.viewConversation(i,!0)}else{e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})})})},e.prototype.deleteChat=function(e,t){this.chats.splice(t,1),e.media||(e.media=[]),e.media.forEach(function(t){r.storage().ref("conversations").child(e.$id).child(t.fileName).delete()}),r.firestore().collection("conversations").doc(e.$id).delete(),e.users.forEach(function(t){r.firestore().collection("users").doc(t.$id).collection("conversations").doc(e.$id).delete()})},e.prototype.viewProfile=function(){var e=this;this.selectedConversation=null;var t=this.modalCtrl.create(g.a);t.onDidDismiss(function(t){e.ngZone.run(function(){e.user=JSON.parse(localStorage.getItem("user"))})}),t.present()},e=d([Object(o.Component)({selector:"page-chats",template:'<div class="profile-tab" *ngIf="isBrowser">\n\n  <img class="user-img self-img" [src]="user?.thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'">\n\n  <h3>{{user?.firstName}} {{user?.lastName}}</h3>\n\n  <button (click)="viewProfile();">View Profile</button>\n\n</div>\n\n\n\n<div class="chats-tab">\n\n  <ion-header>\n\n    <ion-navbar>\n\n      <ion-title>\n\n        Messages\n\n      </ion-title>\n\n    </ion-navbar>\n\n    <ion-fab style="top: 0px;" top right #fab>\n\n      <button ion-fab mini>\n\n        <ion-icon name="add" role="img" class="icon icon-ios ion-ios-add" aria-label="add"></ion-icon>\n\n      </button>\n\n      <ion-fab-list side="bottom" style="right: 0px;">\n\n        <button ion-button (click)="addByContacts(fab)" *ngIf="!isBrowser">\n\n          Contacts <ion-icon name="contacts" style="padding-left: 5px;"></ion-icon>\n\n        </button>\n\n        <button ion-button (click)="addByUsername(fab)">\n\n          Username <ion-icon name="person-add" style="padding-left: 5px;"></ion-icon>\n\n        </button>\n\n        <button ion-button (click)="addByGroupChat(fab)">\n\n          Group Chat <ion-icon name="people" style="padding-left: 5px;"></ion-icon>\n\n        </button>\n\n      </ion-fab-list>\n\n    </ion-fab>\n\n  </ion-header>\n\n\n\n  <ion-content padding>\n\n    \x3c!--<ion-searchbar (ionInput)="getItems($event)"></ion-searchbar>--\x3e\n\n\n\n    <div *ngIf="!chats || !chats.length">\n\n      <br>\n\n      <br>\n\n      <br>\n\n      <h4 text-center>No conversations yet</h4>\n\n    </div>\n\n    <ion-list *ngIf="hasLoadedChats">\n\n      <ion-item-sliding *ngFor="let chat of chats; index as i" #item [class.hasBeenRead]="chat.readBy[user?.$id]">\n\n        <ion-item (click)="viewConversation(chat)" *ngIf="chat" [class.multi-container]="chat?.users && chat?.users.length > 2">\n\n          \x3c!--<ion-avatar item-left>--\x3e\n\n            \x3c!--<img src="./assets/user.png">--\x3e\n\n          \x3c!--</ion-avatar>--\x3e\n\n          <ion-row>\n\n            <ion-col class="first-col" *ngIf="chat?.users && chat?.users.length < 3">\n\n              <img class="user-img" [src]="chat?.users[0].thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'">\n\n            </ion-col>\n\n            <ion-col class="first-col multi-users" *ngIf="chat?.users && chat?.users.length > 2" style="overflow: visible;">\n\n              <img class="user-img" [src]="chat?.users[0].thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'" style="position: absolute; z-index: 999; top: 8px; left: 0px; width: 35px; height: 35px;">\n\n              <img class="user-img" [src]="chat?.users[1].thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'" style="position: absolute; top: -8px; left: 0px; width: 35px; height: 35px;">\n\n              <img class="user-img" [src]="chat?.users[2].thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'" style="position: absolute; left: 15px; width: 35px; height: 35px;">\n\n            </ion-col>\n\n            <ion-col class="second-col" style="overflow-x: hidden;">\n\n              <span class="chat-title">\n\n                <span *ngFor="let chatUser of chat.users">\n\n                  <span *ngIf="chatUser?.username !== user?.username">\n\n                    {{chatUser?.firstName || chatUser?.username}} <span *ngIf="chatUser?.firstName">{{chatUser?.lastName}}</span>\n\n                  </span>\n\n                </span>\n\n              </span>\n\n              <span class="chat-last-time" *ngIf="chat?.lastMessage">\n\n                {{chat?.lastMessage?.time | dayOrTime}}\n\n              </span>\n\n              <span class="chat-last-message" *ngIf="chat?.lastMessage?.type && chat?.lastMessage?.type === \'image\'">\n\n                image.jpg\n\n              </span>\n\n              <span class="chat-last-message" *ngIf="chat?.lastMessage?.message && (!chat?.lastMessage?.type || chat?.lastMessage?.type === \'text\')">\n\n                {{chat?.lastMessage?.message[user?.language] || \'Click to translate\'}}\n\n              </span>\n\n            </ion-col>\n\n          </ion-row>\n\n        </ion-item>\n\n        <ion-item-options side="right">\n\n          <button ion-button color="danger" (click)="deleteChat(chat, i)">Delete</button>\n\n        </ion-item-options>\n\n      </ion-item-sliding>\n\n    </ion-list>\n\n  </ion-content>\n\n</div>\n\n\n\n\n\n<div class="web-navbar">\n\n\n\n</div>\n\n<div class="message-view" *ngIf="selectedConversation">\n\n  <page-conversation [conversation]="selectedConversation"></page-conversation>\n\n</div>\n\n\n\n<div class="message-view message-view-no-chats" *ngIf="!selectedConversation && isBrowser">\n\n  <img src="assets/imgs/logo.png" class="logo" />\n\n  <h1>Welcome to World Chat!</h1>\n\n  <h2>Version 0.29</h2>\n\n  <br>\n\n  <p>Contact us with any questions or concerns:</p>\n\n  <p style="margin-bottom: 7.5px;">Email: TheExhibitionOnTour@gmail.com</p>\n\n  <p style="margin-top: 0px;">Phone: (816) 716-7156</p>\n\n</div>\n\n'}),h("design:paramtypes",[i.r,i.q,i.b,i.w,i.p,l.a,A.a,o.NgZone,i.u])],e)}()},243:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),i=n(9),s=n(135),a=n(32),r=(n.n(a),n(40)),c=n(26),l=(n.n(c),this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}),A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,r)}c((o=o.apply(e,t||[])).next())})},g=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,i=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){r=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){r.label=n[1];break}if(6===n[0]&&r.label<s[1]){r.label=s[1],s=n;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(n);break}s[2]&&r.ops.pop(),r.trys.pop();continue}n=t.call(e,r)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var o,i,s,a,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},d=function(){function e(e,t,n,o,i,s){var a=this;this.navCtrl=e,this.navParams=t,this.viewCtrl=n,this.camera=o,this.actionSheetCtrl=i,this.http=s,this.language=[],this.GetLanguage().subscribe(function(e){a.language=e}),this.user=JSON.parse(localStorage.getItem("user")),this.originalUser=Object.assign({},this.user),this.user.thumb||(this.user.thumb="assets/imgs/nopic-profile.png"),this.lang=this.user.language}return e.prototype.ionViewDidLoad=function(){console.log("ionViewDidLoad ProfileModalPage")},e.prototype.closeModal=function(){this.viewCtrl.dismiss()},e.prototype.presentActionSheet=function(){var e=this;this.actionSheetCtrl.create({buttons:[{text:"Take Photo",handler:function(){e.takePhoto(1)}},{text:"Add Photo",handler:function(){e.takePhoto(0)}},{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}}]}).present()},e.prototype.takePhoto=function(e){var t=this,n=this;this.camera.getPicture({quality:50,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e}).then(function(e){c.storage().ref("users").child(t.user.$id).child("thumb.jpg").putString(e,"base64").then(function(e){c.storage().ref("users").child(n.user.$id).child("thumb.jpg").getDownloadURL().then(function(e){n.user.thumb=e,n.saveProfile()}).catch(function(e){c.firestore().collection("testing").add({downloadUrlPictureError:e})})}).catch(function(e){c.firestore().collection("testing").add({savePictureError:e})})},function(e){c.firestore().collection("testing").add({getPictureError:e})})},e.prototype.saveProfile=function(){return u(this,void 0,void 0,function(){var e,t,n;return g(this,function(o){switch(o.label){case 0:return this.originalUser.email||!this.user.email?[3,4]:[4,c.firestore().collection("emailAuths").doc(this.user.email).get()];case 1:return e=o.sent(),[4,c.firestore().collection("phoneAuths").doc(this.user.phone).get()];case 2:return t=o.sent(),[4,c.firestore().collection("phoneAuths").doc(this.user.fullPhone).get()];case 3:if(n=o.sent(),e.data())return[2,alert("Email Taken")];c.firestore().collection("emailAuths").doc(this.user.email).set({$id:this.user.$id,password:t.data()?t.data().password:n.data().password}),this.originalUser=this.user,o.label=4;case 4:return this.user.language=this.lang,localStorage.setItem("user",JSON.stringify(this.user)),c.firestore().collection("users").doc(this.user.$id).update(this.user),[2]}})})},e.prototype.GetLanguage=function(){return this.http.get("./assets/language/language.json").pipe(Object(a.map)(function(e){return e.array}))},e=l([Object(o.Component)({selector:"page-profile-modal",template:'\x3c!--\n  Generated template for the ProfileModalPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n<ion-header>\n\n  <ion-navbar>\n    <ion-buttons start>\n      <button ion-button (click)="closeModal()">Close</button>\n    </ion-buttons>\n    <ion-title>Set Profile</ion-title>\n  </ion-navbar>\n\n</ion-header>\n\n\n<ion-content padding>\n  <br/>\n  <img [src]="user.thumb" *ngIf="user && user.thumb" (click)="presentActionSheet()" height="150px" width="150px" style="margin: 0px auto; display: block;" />\n\n  <br/>\n\n  <ion-item *ngIf="!originalUser?.email">\n    <ion-label color="primary" stacked style="overflow: visible;"><b>Set email (can be used to login). !Warning! Cannot be changed.</b></ion-label>\n    <ion-input type="email" placeholder="Email" [(ngModel)]="user.email"></ion-input>\n  </ion-item>\n  <button ion-button (click)="saveProfile()" style="margin-left: 20px;" *ngIf="!originalUser?.email">Finalize Email</button>\n\n  <br>\n\n  <ion-item>\n    <ion-label color="primary" stacked>First Name</ion-label>\n    <ion-input type="text" placeholder="First Name" [(ngModel)]="user.firstName" (ionChange)="saveProfile()"></ion-input>\n  </ion-item>\n  <br/>\n  <ion-item>\n    <ion-label color="primary" stacked>Last Name</ion-label>\n    <ion-input type="text" placeholder="Last Name" [(ngModel)]="user.lastName" (ionChange)="saveProfile()"></ion-input>\n  </ion-item>\n  <br/>\n  <ion-item>\n    <ion-select [(ngModel)]="lang" (ionChange)="saveProfile()">\n      <ion-option *ngFor="let o of language" [value]="o.code">{{o.name}}</ion-option>\n    </ion-select>\n  </ion-item>\n\n</ion-content>\n'}),A("design:paramtypes",[i.r,i.s,i.y,s.a,i.a,r.a])],e)}()},246:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),i=n(9),s=n(58),a=n(60),r=n(26),c=(n.n(r),n(137)),l=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n,o,i,s){this.navCtrl=e,this.modalCtrl=t,this.alertCtrl=n,this.toastCtrl=o,this.loadingCtrl=i,this.sms=s,this.searchQuery="",this.people=[],this.browser=!1,this.browser=!!JSON.parse(localStorage.getItem("isBrowser")),this.user=JSON.parse(localStorage.getItem("user"))}return e.prototype.ionViewWillEnter=function(){this.user=JSON.parse(localStorage.getItem("user"))},e.prototype.addByUsername=function(){var e=this;this.alertCtrl.create({title:"Start a conversation",inputs:[{name:"username",placeholder:"Enter Username"}],buttons:[{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}},{text:"Add",handler:function(t){if(t.username)if(t.username!=e.user.username)r.firestore().collection("users").where("username","==",t.username.toLowerCase()).get().then(function(t){if(!t.docs.length){e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}t.forEach(function(t){if(t.data())e.people.push(t.data());else{e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})});else{e.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}}}]}).present()},e.prototype.addByContacts=function(){var e=this,t=this.modalCtrl.create(a.a);t.onDidDismiss(function(t){if(t){if(t==e.user.phone){return void e.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}var n=e.loadingCtrl.create({content:"Searching for user..."});n.present();var o=[],i=[new Promise(function(e,n){r.firestore().collection("users").where("fullPhone","==","+"+t).get().then(function(t){t.forEach(function(e){o.push(e)}),e()})}),new Promise(function(e,n){r.firestore().collection("users").where("phone","==",t).get().then(function(t){t.forEach(function(e){o.push(e)}),e()})})];Promise.all(i).then(function(i){if(n.dismiss(),o.length)o.forEach(function(t){if(t.data()){if(t.data().username==e.user.username){return void e.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}e.people.push(t.data())}else{e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}});else{e.sms.send(t.toString()+" ",(e.user.firstName||e.user.username)+" invited you to download World Chat! Android: https://play.google.com/store/apps/details?id=com.letschat.mobile");e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})}}),t.present()},e.prototype.newConversation=function(){var e=this.loadingCtrl.create({content:"Starting Chat.."});e.present();var t=r.firestore().collection("conversations").doc(),n=[],o=[];this.people.push(this.user),this.people.forEach(function(e){n.push({$id:e.$id,username:e.username,firstName:e.firstName||"",lastName:e.lastName||"",language:e.language}),o.push(e.language),r.firestore().collection("users").doc(e.$id).collection("conversations").doc(t.id).set({chatId:t.id})});var i={$id:t.id,users:n,languages:o,readBy:{}};i.readBy[this.user.$id]=this.user.username,r.firestore().collection("conversations").doc(t.id).set(i),e.dismiss(),this.viewConversation(i)},e.prototype.viewConversation=function(e){this.navCtrl.push(s.a,{conversation:e})},e.prototype.removePerson=function(e,t){this.people.splice(t,1)},e=l([Object(o.Component)({selector:"page-start-group-chat",template:'<ion-header>\n\n  <ion-navbar>\n\n    <ion-title>\n\n      Start Group Chat\n\n    </ion-title>\n\n  </ion-navbar>\n\n</ion-header>\n\n\n\n<ion-content padding>\n\n  \x3c!--<ion-searchbar (ionInput)="getItems($event)"></ion-searchbar>--\x3e\n\n  <ion-list>\n\n\n\n    <button ion-button (click)="addByContacts()" *ngIf="!browser">\n\n      Add a person via Contacts <ion-icon name="contacts" style="padding-left: 5px;"></ion-icon>\n\n    </button>\n\n    <button ion-button (click)="addByUsername()">\n\n      Add a person via Username <ion-icon name="person-add" style="padding-left: 5px;"></ion-icon>\n\n    </button>\n\n\n\n\n\n    <ion-item-sliding *ngFor="let person of people" #item>\n\n      <ion-item>\n\n        \x3c!--<ion-avatar item-left>--\x3e\n\n          \x3c!--<img src="./assets/user.png">--\x3e\n\n        \x3c!--</ion-avatar>--\x3e\n\n        {{person.firstName || person.userName}} <span *ngIf="person.firstName">{{person.lastName || \'\'}}</span>\n\n      </ion-item>\n\n      <ion-item-options side="right">\n\n        <button ion-button color="danger" (click)="removePerson(person, i)">Remove</button>\n\n      </ion-item-options>\n\n    </ion-item-sliding>\n\n\n\n    <button ion-button (click)="newConversation()" *ngIf="people && people.length > 0">\n\n      Start Conversation\n\n    </button>\n\n  </ion-list>\n\n</ion-content>\n\n'}),A("design:paramtypes",[i.r,i.q,i.b,i.w,i.p,c.a])],e)}()},247:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),i=n(9),s=n(32),a=(n.n(s),n(40)),r=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=(function(){}(),function(){}(),function(){function e(e,t){this.http=e,this.events=t}return e.prototype.mockNewMsg=function(e){var t=this,n={messageId:Date.now().toString(),userId:"210000198410281948",userName:"Admin",userAvatar:"./assets/user.png",toUserId:"140000198202211138",time:Date.now(),message:e.message,status:"success"};setTimeout(function(){t.events.publish("chat:received",n,Date.now())},1800*Math.random())},e.prototype.getMsgList=function(){return this.http.get("./assets/mock/msg-list.json").pipe(Object(s.map)(function(e){return e.array}))},e.prototype.sendMsg=function(e){var t=this;return new Promise(function(t){return setTimeout(function(){return t(e)},1e3*Math.random())}).then(function(){return t.mockNewMsg(e)})},e.prototype.getUserInfo=function(){var e={id:"140000198202211138",name:"User",avatar:"./assets/to-user.png"};return new Promise(function(t){return t(e)})},e=r([Object(o.Injectable)(),c("design:paramtypes",[a.a,i.i])],e)}())},248:function(e,t,n){"use strict";n.d(t,"a",function(){return A});var o=n(0),i=n(9),s=n(26),a=(n.n(s),n(32)),r=(n.n(a),n(40)),c=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=function(){function e(e,t){var n=this;this.http=e,this.viewCtrl=t,this.language=[],this.GetLanguage().subscribe(function(e){n.language=e}),this.user=JSON.parse(localStorage.getItem("user")),this.user&&s.firestore().collection("users").doc(this.user.$id).get().then(function(e){n.user=e.data(),n.username=n.user.username,n.lang=n.user.language})}return e.prototype.GetLanguage=function(){return this.http.get("./assets/language/language.json").pipe(Object(a.map)(function(e){return e.array}))},e.prototype.complete=function(e,t){var n=this,o=this;this.user.language=e,this.user.username=t.toLowerCase(),this.user.complete=!0;s.storage().ref("users").child(this.user.$id).child("thumb.jpg").putString("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","base64").then(function(e){s.storage().ref("users").child(o.user.$id).child("thumb.jpg").getDownloadURL().then(function(e){n.user.thumb=e,s.firestore().collection("users").doc(n.user.$id).update(n.user),localStorage.setItem("user",JSON.stringify(n.user)),n.viewCtrl.dismiss(n.user)})})},e=c([Object(o.Component)({selector:"page-complete-profile",template:'\x3c!--\n  Generated template for the LoginPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n<ion-header>\n\n  <ion-navbar>\n    <ion-title>Complete Settings</ion-title>\n  </ion-navbar>\n\n</ion-header>\n\n<ion-content padding>\n\n  <ion-item>\n    <ion-label>Select Language</ion-label>\n    <ion-select [(ngModel)]="lang">\n      <ion-option *ngFor="let o of language" [value]="o.code">{{o.name}}</ion-option>\n    </ion-select>\n  </ion-item>\n  <ion-input type="text" placeholder="Username" [(ngModel)]="username"></ion-input>\n  <div text-center>\n    <button text-center ion-button clear (click)="complete(lang, username)">Continue</button>\n  </div>\n\n</ion-content>\n'}),l("design:paramtypes",[r.a,i.y])],e)}()},249:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),i=n(26),s=(n.n(i),n(9)),a=n(72),r=n(73),c=n(58),l=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n,o){this.modalCtrl=e,this.navCtrl=t,this.toastCtrl=n,this.barcodeScanner=o,this.user=JSON.parse(localStorage.getItem("user"))}return e.prototype.ngOnInit=function(){this.addTempChat()},e.prototype.addTempChat=function(){var e=this;this.barcodeScanner.scan({prompt:"Scan a Profile Code"}).then(function(t){"QR_CODE"==t.format&&i.firestore().collection("users").where("$id","==",t.text).get().then(function(t){if(!t.docs.length){e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}t.forEach(function(t){if(t.data()){var n=t.data(),o=i.firestore().collection("tempConversations").doc();i.firestore().collection("users").doc(e.user.$id).collection("tempConversations").doc(o.id).set({chatId:o.id}),i.firestore().collection("users").doc(n.$id).collection("tempConversations").doc(o.id).set({chatId:o.id});var s={$id:o.id,users:[{$id:e.user.$id,username:e.user.username,firstName:e.user.firstName||"",lastName:e.user.lastName||"",language:e.user.language},{$id:n.$id,username:n.username,firstName:n.firstName||"",lastName:n.lastName||"",language:n.language}],languages:[e.user.language,n.language],readBy:{}};s.readBy[e.user.$id]=e.user.username,i.firestore().collection("tempConversations").doc(o.id).set(s),e.viewConversation(s,!0)}else{e.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})})})},e.prototype.viewConversation=function(e,t){void 0===t&&(t=!1),this.navCtrl.push(t?r.a:c.a,{conversation:e})},e=l([Object(o.Component)({selector:"page-temp-chat",template:'\x3c!--\n  Generated template for the LoginPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n<ion-header>\n\n  <ion-navbar>\n    <ion-title>Temp Chat</ion-title>\n  </ion-navbar>\n\n</ion-header>\n\n<ion-content padding>\n\n  <button text-center ion-button clear (click)="addTempChat()">Re-Scan</button>\n\n</ion-content>\n'}),A("design:paramtypes",[s.q,s.r,s.w,a.a])],e)}()},254:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){}return e.prototype.getEmojis=function(){for(var e="😀 😃 😄 😁 😆 😅 😂 🤣 ☺️ 😊 😇 🙂 🙃 😉 😌 😍 😘 😗 😙 😚 😋 😜 😝 😛 🤑 🤗 🤓 😎 🤡 🤠 😏 😒 😞 😔 😟 😕 🙁 ☹️ 😣 😖 😫 😩 😤 😠 😡 😶 😐 😑 😯 😦 😧 😮 😲 😵 😳 😱 😨 😰 😢 😥 🤤 😭 😓 😪 😴 🙄 🤔 🤥 😬 🤐 🤢 🤧 😷 🤒 🤕 😈 👿 👹 👺 💩 👻 💀 ☠️ 👽 👾 🤖 🎃 😺 😸 😹 😻 😼 😽 🙀 😿 😾 👐 🙌 👏 🙏 🤝 👍 👎 👊 ✊ 🤛 🤜 🤞 ✌️ 🤘 👌 👈 👉 👆 👇 ☝️ ✋ 🤚 🖐 🖖 👋 🤙 💪 🖕 ✍️ 🤳 💅 🖖 💄 💋 👄 👅 👂 👃 👣 👁 👀 🗣 👤 👥 👶 👦 👧 👨 👩 👱‍♀️ 👱 👴 👵 👲 👳‍♀️ 👳 👮‍♀️ 👮 👷‍♀️ 👷 💂‍♀️ 💂 🕵️‍♀️ 🕵️ 👩‍⚕️ 👨‍⚕️ 👩‍🌾 👨‍🌾 👩‍🍳 👨‍🍳 👩‍🎓 👨‍🎓 👩‍🎤 👨‍🎤 👩‍🏫 👨‍🏫 👩‍🏭 👨‍🏭 👩‍💻 👨‍💻 👩‍💼 👨‍💼 👩‍🔧 👨‍🔧 👩‍🔬 👨‍🔬 👩‍🎨 👨‍🎨 👩‍🚒 👨‍🚒 👩‍✈️ 👨‍✈️ 👩‍🚀 👨‍🚀 👩‍⚖️ 👨‍⚖️ 🤶 🎅 👸 🤴 👰 🤵 👼 🤰 🙇‍♀️ 🙇 💁 💁‍♂️ 🙅 🙅‍♂️ 🙆 🙆‍♂️ 🙋 🙋‍♂️ 🤦‍♀️ 🤦‍♂️ 🤷‍♀️ 🤷‍♂️ 🙎 🙎‍♂️ 🙍 🙍‍♂️ 💇 💇‍♂️ 💆 💆‍♂️ 🕴 💃 🕺 👯 👯‍♂️ 🚶‍♀️ 🚶 🏃‍♀️ 🏃 👫 👭 👬 💑 👩‍❤️‍👩 👨‍❤️‍👨 💏 👩‍❤️‍💋‍👩 👨‍❤️‍💋‍👨 👪 👨‍👩‍👧 👨‍👩‍👧‍👦 👨‍👩‍👦‍👦 👨‍👩‍👧‍👧 👩‍👩‍👦 👩‍👩‍👧 👩‍👩‍👧‍👦 👩‍👩‍👦‍👦 👩‍👩‍👧‍👧 👨‍👨‍👦 👨‍👨‍👧 👨‍👨‍👧‍👦 👨‍👨‍👦‍👦 👨‍👨‍👧‍👧 👩‍👦 👩‍👧 👩‍👧‍👦 👩‍👦‍👦 👩‍👧‍👧 👨‍👦 👨‍👧 👨‍👧‍👦 👨‍👦‍👦 👨‍👧‍👧 👚 👕 👖 👔 👗 👙 👘 👠 👡 👢 👞 👟 👒 🎩 🎓 👑 ⛑ 🎒 👝 👛 👜 💼 👓 🕶 🌂 ☂️".split(" "),t=Math.ceil(e.length/24),n=[],o=0;o<t;o++)n.push(e.slice(24*o,24*(o+1)));return n},e}()},274:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(275),i=n(282);Object(o.a)().bootstrapModule(i.a)},282:function(e,t,n){"use strict";n.d(t,"a",function(){return L});var o=n(0),i=n(45),s=n(9),a=n(320),r=n(240),c=n(59),l=n(340),A=n(130),u=n(136),g=n(60),d=n(237),h=n(244),f=n(341),p=n(58),m=n(254),w=n(40),b=n(343),v=n(247),y=n(344),C=n(248),B=n(358),D=n(359),P=n(243),x=n(250),I=n(251),Q=n(135),E=n(360),M=n(246),N=n(137),k=n(72),j=n(361),O=n(73),S=n(249),G=n(252),R=n(363),U=n(468),F=(n.n(U),n(469)),H=(n.n(F),n(245)),T=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},L=function(){function e(){}return e=T([Object(o.NgModule)({declarations:[a.a,r.a,S.a,M.a,c.a,l.a,p.a,O.a,A.a,u.a,C.a,y.a,E.a,B.a,D.a,b.a,g.a,P.a],imports:[i.a,w.b,f.a,j.a,R.a,U.LazyLoadImagesModule,F.LinkyModule,s.o.forRoot(a.a,{tabsHideOnSubPages:!0,preloadModules:!0,mode:"md"},{links:[]})],bootstrap:[s.m],entryComponents:[a.a,r.a,S.a,M.a,c.a,l.a,p.a,O.a,A.a,u.a,C.a,g.a,P.a],providers:[d.a,m.a,H.a,v.a,h.a,x.a,I.a,Q.a,N.a,k.a,G.a,{provide:o.ErrorHandler,useClass:s.n}],schemas:[o.CUSTOM_ELEMENTS_SCHEMA]})],e)}()},320:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),i=n(9),s=n(237),a=n(130),r=n(136),c=n(26),l=n.n(c),A=n(250),u=n(251),g=n(252),d=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,i){var s=this;this.admob=n,this.device=o,this.firebaseMessaging=i,this.rootPage=r.a,this.isIphoneX=!1,this.isBrowser=!1,t.show(),l.a.initializeApp({apiKey:"AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk",authDomain:"letstalk-205602.firebaseapp.com",databaseURL:"https://letstalk-205602.firebaseio.com",projectId:"letstalk-205602",storageBucket:"letstalk-205602.appspot.com",messagingSenderId:"893888740923"});l.a.firestore().settings({timestampsInSnapshots:!0}),this.isBrowser=e.is("core")||e.is("mobileweb"),localStorage.setItem("isBrowser",this.isBrowser),e.ready().then(function(){if("iPhone10,3"!==s.device.model&&"iPhone10,6"!==s.device.model||(s.isIphoneX=!0),localStorage.getItem("user")){var n=JSON.parse(localStorage.getItem("user"));s.rootPage=a.a,!s.isBrowser&&window.cordova&&(s.firebaseMessaging.getToken().then(function(e){n.token=e,l.a.firestore().collection("users").doc(n.$id).update(n)}).catch(function(e){return console.error("Error getting token",e)}),s.firebaseMessaging.onTokenRefresh().subscribe(function(e){n.token=e,l.a.firestore().collection("users").doc(n.$id).update(n)}))}if(setTimeout(function(){t.hide()},1e3),!s.isBrowser)try{var o={isTesting:!1,id:e.is("ios")?"ca-app-pub-9161240946129783/2043371307":"ca-app-pub-9161240946129783/3619767735",autoShow:!0};s.admob.banner.config(o),l.a.firestore().collection("hello").doc(Date.now()+"").set({data:"3"}),s.admob.banner.prepare().then(function(){}).catch(function(e){console.log(e),l.a.firestore().collection("hello").doc(Date.now()+"").set({data:JSON.stringify(e)})})}catch(e){console.log(e),l.a.firestore().collection("hello").doc(Date.now()+"").set({data:JSON.stringify(e)})}})}return e=d([Object(o.Component)({template:"<ion-nav [root]=\"rootPage\" [ngClass]=\"{'isIphoneX': isIphoneX, 'isBrowser': isBrowser}\"></ion-nav>\n"}),h("design:paramtypes",[i.u,s.a,A.a,g.a,u.a])],e)}()},340:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(0),i=n(9),s=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=function(){function e(e){this.navCtrl=e}return e=s([Object(o.Component)({selector:"page-home",template:"<ion-header>\n  <ion-navbar>\n    <ion-title>My Status</ion-title>\n  </ion-navbar>\n</ion-header>\n\n<ion-content padding>\n  My Status\n</ion-content>\n"}),a("design:paramtypes",[i.r])],e)}()},343:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),i=n(254),s=n(21),a=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c={provide:s.b,useExisting:Object(o.forwardRef)(function(){return l}),multi:!0},l=function(){function e(e){this.emojiArr=[],this.emojiArr=e.getEmojis()}return e.prototype.writeValue=function(e){this._content=e},e.prototype.registerOnChange=function(e){this._onChanged=e,this.setValue(this._content)},e.prototype.registerOnTouched=function(e){this._onTouched=e},e.prototype.setValue=function(e){this._content+=e,this._content&&this._onChanged(this._content)},e=a([Object(o.Component)({selector:"emoji-picker",providers:[c],template:'\x3c!-- Generated template for the EmojiPickerComponent component --\x3e\n<div class="emoji-picker">\n  <div class="emoji-items">\n    <ion-slides pager>\n\n      <ion-slide *ngFor="let items of emojiArr">\n        <span class="emoji-item" (click)="setValue(item)" *ngFor="let item of items">\n          {{item}}\n        </span>\n      </ion-slide>\n\n    </ion-slides>\n  </div>\n</div>\n'}),r("design:paramtypes",[i.a])],e)}()},344:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(0),i=n(345),s=n.n(i),a=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=function(){function e(){}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return s()(new Date(e),{addSuffix:!0})},e=a([Object(o.Pipe)({name:"relativeTime"})],e)}()},358:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),i=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},s=function(){function e(){}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.sort(function(e,t){return e.time-t.time}),e},e=i([Object(o.Pipe)({name:"sortByTime"})],e)}()},359:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),i=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},s=function(){function e(){}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return console.log(e),e.sort(function(e,t){return console.log(e,t),e.lastMessage||(e.lastMessage={time:Date.now()}),t.lastMessage||(t.lastMessage={time:Date.now()}),t.lastMessage.time-e.lastMessage.time}),e},e=i([Object(o.Pipe)({name:"sortByLastMessage"})],e)}()},360:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),i=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},s=function(){function e(){}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o,i=new Date(e),s=new Date,a=!0;return s.getDate()==i.getDate()&&s.getMonth()==i.getMonth()&&s.getFullYear()==i.getFullYear()&&(a=!1,o=i.getHours()>=12?"pm":"am"),a?i.getMonth()+1+"-"+i.getDate():(i.getHours()>12?i.getHours()-12:i.getHours())+":"+i.getMinutes()+o},e=i([Object(o.Pipe)({name:"dayOrTime"})],e)}()},58:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),i=n(9),s=n(40),a=n(26),r=(n.n(a),n(59)),c=n(60),l=n(135),A=n(245),u=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,r)}c((o=o.apply(e,t||[])).next())})},h=this&&this.__generator||function(e,t){function n(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,i=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){r=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){r.label=n[1];break}if(6===n[0]&&r.label<s[1]){r.label=s[1],s=n;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(n);break}s[2]&&r.ops.pop(),r.trys.pop();continue}n=t.call(e,r)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var o,i,s,a,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},f=function(){function e(e,t,n,o,i,s,a,r,c,l,A,u){var g=this;this.navCtrl=e,this.navParams=t,this.http=n,this.ngZone=o,this.modalCtrl=i,this.alertCtrl=s,this.toastCtrl=a,this.loadingCtrl=r,this.camera=c,this.actionSheetCtrl=l,this.platform=A,this.clipboard=u,this.msgList=[],this.editorMsg="",this.showEmojiPicker=!1,this.hasLoadedMessages=!1,this.readBy=[],this.typing=!1,this.objectKeys=Object.keys,this.link="www.google.com",this.info={title:"",description:"",icon:"",site:""},this.urlRegex=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,this.lastInputScrollHeight=0,this.isBrowser=!1,this.loadingStopped=!0,this.hasScrolled=!1,this.firebaseSubs=[],this.lastMessageSent={$id:""},this.avoidDuplicateAfterSending={},this.loadingMore=!1,this.lastInputTextLength=0,this.profile=JSON.parse(localStorage.getItem("user")),this.ngZone.run(function(){g.firebaseSubs.forEach(function(e){e()})})}return e.prototype.ngOnChanges=function(e){var t=this;e&&e.conversation&&this.ngZone.run(function(){t.firebaseSubs.forEach(function(e){e()}),t.conversation=e.conversation.currentValue,t.ngOnInit()})},e.prototype.ngOnInit=function(){var e=this;if(this.hasScrolled=!1,this.isBrowser=this.platform.is("core")||this.platform.is("mobileweb"),this.user=JSON.parse(localStorage.getItem("user")),this.navParams.get("conversation")&&(this.conversation=this.navParams.get("conversation")),this.conversation){this.getMsg();var t=this.conversation.users;this.firebaseSubs.push(a.firestore().collection("conversations").doc(this.conversation.$id).onSnapshot(function(n){if(e.conversation=n.data(),e.conversation){var o=!1;e.conversation.languages.forEach(function(t){t==e.user.language&&(o=!0)}),e.conversation.users.forEach(function(n){t.forEach(function(t,o){t.$id===n.$id&&(e.conversation.users[o].firstName=t.firstName||"",e.conversation.users[o].lastName=t.lastName||"",e.conversation.users[o].thumb=t.thumb||"")})}),o||(e.conversation.languages.push(e.user.language),e.http.get("https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+e.user.language+"&q="+e.conversation.lastMessage.message[e.conversation.lastMessage.translatedFrom]+"&format=text").toPromise().then(function(t){e.conversation.lastMessage.message[e.user.language]=t.data.translations[0].translatedText,a.firestore().collection("conversations").doc(e.conversation.$id).update(e.conversation)})),e.readBy=[];Object.keys(e.conversation.readBy).forEach(function(t){e.readBy.push(e.conversation.readBy[t])})}}));var n;if(JSON.parse(localStorage.getItem("isBrowser"))){if(!(n=document.getElementsByClassName("scroll-content")[1]))return;n.scrollTop=n.scrollHeight}else if(this.content._scroll){if(!(n=document.getElementsByClassName("scroll-content")[0]))return;n.scrollTop=n.scrollHeight}n.onscroll=function(){n.scrollTop&&n.scrollTop<100&&!e.loadingMore&&(e.loadingMore=!0,e.getNextSetOfMessages(n))}}},e.prototype.resizeView=function(){document.getElementById("message-entry").style.height=document.getElementById("message-entry").scrollHeight+"px";var e=document.getElementById("message-entry").scrollHeight-35>65?65:document.getElementById("message-entry").scrollHeight-35;document.getElementsByClassName("message-wrap")[0].style.marginBottom=e+"px",this.scrollToBottom(),this.lastInputScrollHeight=document.getElementById("message-entry").scrollHeight},e.prototype.resetView=function(){document.getElementById("message-entry").style.height="auto",document.getElementsByClassName("message-wrap")[0].style.marginBottom="0px",this.lastInputScrollHeight=document.getElementById("message-entry").scrollHeight},e.prototype.isTyping=function(e){var t=this,n=!1;this.editorMsg.length<this.lastInputTextLength&&(JSON.parse(localStorage.getItem("isBrowser"))||(document.getElementById("message-entry").style.height="auto",n=!0)),this.lastInputTextLength=this.editorMsg.length,(n||document.getElementById("message-entry").scrollHeight!==this.lastInputScrollHeight)&&(JSON.parse(localStorage.getItem("isBrowser"))||this.resizeView()),this.conversation.typing||(this.conversation.typing={}),this.typing||(this.conversation.typing[this.user.$id]=!0,a.firestore().collection("conversations").doc(this.conversation.$id).update(this.conversation)),this.typing=!0,setTimeout(function(){t.typing=!1,setTimeout(function(){t.typing||(t.conversation.typing[t.user.$id]=!1,a.firestore().collection("conversations").doc(t.conversation.$id).update(t.conversation))},200)},1e3)},e.prototype.copyText=function(e){if(JSON.parse(localStorage.getItem("isBrowser"))){var t=document.getElementById("copy-container");t.value=e,t.select(),document.execCommand("copy")}else this.clipboard.copy(e);this.toastCtrl.create({message:"Copied to clipboard!",duration:3e3,position:"bottom"}).present()},e.prototype.ionViewDidLoad=function(){},e.prototype.ionViewWillLeave=function(){this.firebaseSubs.forEach(function(e){e()})},e.prototype.ionViewDidEnter=function(){},e.prototype.onFocus=function(){JSON.parse(localStorage.getItem("isBrowser"))||(this.showEmojiPicker=!1,this.content.resize(),this.scrollToBottom())},e.prototype.switchEmojiPicker=function(){JSON.parse(localStorage.getItem("isBrowser"))||(this.showEmojiPicker=!this.showEmojiPicker,this.showEmojiPicker?this.setTextareaScroll():this.focus(),this.content.resize(),this.scrollToBottom())},e.prototype.getMsg=function(){var e=this;setTimeout(function(){},3e3),this.loadingStopped&&(this.loading=this.loadingCtrl.create({content:"Please wait..."}),this.loading.present(),this.loadingStopped=!1),this.firebaseSubs.push(a.firestore().collection("conversations").doc(this.conversation.$id).collection("messages").orderBy("time","desc").limit(25).onSnapshot(function(t){e.loadingStopped||(e.msgList=[]),setTimeout(function(){e.loadingStopped||(e.loading.dismiss(),e.loadingStopped=!0,e.hasScrolled=!0)},200),t.docChanges().forEach(function(t){if("added"===t.type){var n=t.doc.data();n.message[e.user.language]||n.mediaUrl?e.ngZone.run(function(){t.doc.data().$id!=e.lastMessageSent.$id||e.avoidDuplicateAfterSending[t.doc.data().$id]?e.avoidDuplicateAfterSending[t.doc.data().$id]||e.msgList.unshift(t.doc.data()):(e.avoidDuplicateAfterSending[t.doc.data().$id]=!0,e.msgList.push(t.doc.data())),setTimeout(function(){e.scrollToBottom()},100)}):e.http.get("https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+e.user.language+"&q="+n.message[n.translatedFrom]+"&format=text").toPromise().then(function(o){n.message[e.user.language]=o.data.translations[0].translatedText,a.firestore().collection("conversations").doc(e.conversation.$id).collection("messages").doc(t.doc.id).update(n),e.ngZone.run(function(){e.avoidDuplicateAfterSending[n.$id]||e.msgList.unshift(n),e.scrollToBottom()})},function(e){alert("Check Internet Connection")})}}),e.hasLoadedMessages||(e.hasLoadedMessages=!0),e.conversation.readBy[e.user.$id]=e.user.username,a.firestore().collection("conversations").doc(e.conversation.$id).update({readBy:e.conversation.readBy}),e.lastVisible=t.docs[t.docs.length-1]}))},e.prototype.getNextSetOfMessages=function(e){var t=this,n=!1;a.firestore().collection("conversations").doc(this.conversation.$id).collection("messages").orderBy("time","desc").startAfter(this.lastVisible).limit(25).get().then(function(o){t.lastVisible=o.docs[o.docs.length-1],t.loadingMore=!1,o.docChanges().forEach(function(o){"added"===o.type&&(e&&!n&&(n=!0,e.scrollTop=5),t.msgList.unshift(o.doc.data()))})})},e.prototype.openLink=function(e){window.open(e)},e.prototype.linkify=function(e){var t=null;return e.replace(this.urlRegex,function(e){t=e}),t},e.prototype.sendMsg=function(e){return void 0===e&&(e=null),d(this,void 0,void 0,function(){var t,n,o,i,s,r,c,l,A=this;return h(this,function(u){switch(u.label){case 0:return e||this.editorMsg.trim()?(this.editorMsg.trim()&&(this.editorMsg=this.editorMsg.replace("↵","")),t={link:null},this.linkify(this.editorMsg)?(n=t,[4,this.loadLinkPreview(this.linkify(this.editorMsg))]):[3,2]):[2];case 1:n.link=u.sent(),u.label=2;case 2:return o=this.conversation,i=a.firestore().collection("conversations").doc(o.$id).collection("messages").doc(),s={$id:i.id,sentBy:this.user.$id,username:this.user.username,firstName:this.user.firstName||"",lastName:this.user.lastName||"",translatedFrom:this.user.language,thumb:this.user.thumb||"",time:Date.now(),type:e?"image":"text",mediaUrl:e,message:{},meta:t},r=[],this.conversation.languages.forEach(function(e){var t=new Promise(function(t,n){var o="https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+e+"&q="+A.editorMsg+"&format=text";A.http.get(o).toPromise().then(function(n){s.message[e]=n.data.translations[0].translatedText,t()},function(n){A.http.get(o).toPromise().then(function(n){s.message[e]=n.data.translations[0].translatedText,t()},function(e){})})});r.push(t)}),c=[],this.conversation.users.forEach(function(e){if(e.$id!==A.user.$id){var t=new Promise(function(t,n){a.firestore().collection("users").doc(e.$id).get().then(function(e){e.data().token&&c.push(e.data().token),t()}).catch(function(){t()})});r.push(t)}}),s.message[this.user.language]=this.editorMsg||"",this.editorMsg="",JSON.parse(localStorage.getItem("isBrowser"))||this.resetView(),this.showEmojiPicker||this.focus(),l={},this.conversation.readBy&&Object.keys(this.conversation.readBy).forEach(function(e){l[e]=""}),l[this.user.$id]=this.user.username,this.conversation.readBy=l,Promise.all(r).then(function(e){a.firestore().collection("conversations").doc(o.$id).collection("messages").doc(s.$id).set(s),a.firestore().collection("conversations").doc(o.$id).update({lastMessage:s,readBy:l}),A.lastMessageSent=s;A.http.post("https://us-central1-letstalk-205602.cloudfunctions.net/sendMessage",{message:s,tokens:c}).toPromise().then(function(e){}).catch(function(e){console.log(e)})}),this.scrollToBottom(),[2]}})})},e.prototype.pushNewMsg=function(e){},e.prototype.addByUsername=function(e){var t=this;e.close();this.alertCtrl.create({title:"Start a conversation",inputs:[{name:"username",placeholder:"Enter Username"}],buttons:[{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}},{text:"Add",handler:function(e){if(e.username)if(e.username!=t.user.username)a.firestore().collection("users").where("username","==",e.username.toLowerCase()).get().then(function(e){if(!e.docs.length){t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}e.forEach(function(e){if(e.data())t.addUser(e.data());else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})});else{t.toastCtrl.create({message:"You cannot invite yourself.",duration:3e3,position:"bottom"}).present()}}}]}).present()},e.prototype.addByContacts=function(e){var t=this;e.close();var n=this.modalCtrl.create(c.a);n.onDidDismiss(function(e){if(e){if(e==t.user.phone){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}var n=t.loadingCtrl.create({content:"Searching for user..."});n.present();var o=[],i=[new Promise(function(t,n){a.firestore().collection("users").where("fullPhone","==","+"+e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})}),new Promise(function(t,n){a.firestore().collection("users").where("phone","==",e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})})];Promise.all(i).then(function(e){if(n.dismiss(),o.length)o.forEach(function(e){if(e.data()){if(e.data().username==t.user.username){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}t.addUser(e.data())}else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}});else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})}}),n.present()},e.prototype.addUser=function(e){a.firestore().collection("users").doc(this.user.$id).collection("conversations").doc(this.conversation.$id).set({chatId:this.conversation.$id}),this.conversation.users.push({$id:e.$id,language:e.language,username:e.username,firstName:e.firstName||"",lastName:e.lastName||""});var t=!1;this.conversation.languages.forEach(function(n){n==e.language&&(t=!0)}),t||this.conversation.languages.push(e.language),a.firestore().collection("conversations").doc(this.conversation.$id).update(this.conversation)},e.prototype.getMsgIndexById=function(e){return this.msgList.findIndex(function(t){return t.messageId===e})},e.prototype.viewProfile=function(e){this.navCtrl.push(r.a,{profile:e})},e.prototype.didScroll=function(e){console.log(e)},e.prototype.scrollToBottom=function(){var e;if(JSON.parse(localStorage.getItem("isBrowser"))){if(!(e=document.getElementsByClassName("scroll-content")[1]))return;e.scrollTop=e.scrollHeight}else this.content&&this.content.scrollToBottom&&this.content.scrollToBottom()},e.prototype.focus=function(){this.messageInput&&this.messageInput.nativeElement&&this.messageInput.nativeElement.focus()},e.prototype.setTextareaScroll=function(){var e=this.messageInput.nativeElement;e.scrollTop=e.scrollHeight},e.prototype.takePhoto=function(e){var t=this;this.camera.getPicture({quality:50,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,correctOrientation:!0,sourceType:e}).then(function(e){var n=t.loadingCtrl.create({content:"Sending Image..."});n.present();var o=Date.now();t.conversation.media||(t.conversation.media=[]),a.storage().ref("conversations").child(t.conversation.$id).child(o+".jpg").putString(e,"base64").then(function(e){a.storage().ref("conversations").child(t.conversation.$id).child(o+".jpg").getDownloadURL().then(function(e){n.dismiss(),t.sendMsg(e),t.conversation.media.push({downloadUrl:e,fileName:o+".jpg"}),a.firestore().collection("conversations").doc(t.conversation.$id).update(t.conversation)}).catch(function(e){n.dismiss(),a.firestore().collection("testing").add({downloadUrlPictureError:e}),alert("error")})}).catch(function(e){n.dismiss(),a.firestore().collection("testing").add({savePictureError:e}),alert("error")})},function(e){a.firestore().collection("testing").add({getPictureError:e}),alert("error")})},e.prototype.presentActionSheet=function(){var e=this;this.actionSheetCtrl.create({buttons:[{text:"Take Photo",handler:function(){e.takePhoto(1)}},{text:"Add Photo",handler:function(){e.takePhoto(0)}},{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}}]}).present()},e.prototype.loadLinkPreview=function(e){return d(this,void 0,void 0,function(){var t,n,o,i;return h(this,function(s){switch(s.label){case 0:return t=encodeURIComponent(e),n="https://opengraph.io/api/1.0/site/"+t,(o="5b85babfd90988b55a3f7034")&&(n="https://opengraph.io/api/1.0/site/"+t+"?app_id="+o),i={title:"",description:"",icon:"",site:e,rawUrl:e},[4,new Promise(function(e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.onload=function(){if(t.status>=200&&t.status<400){var n=JSON.parse(t.responseText);n&&n.hybridGraph||e(),i.title=n.hybridGraph.title,i.description=n.hybridGraph.description,i.icon=n.hybridGraph.image,i.site=n.hybridGraph.site_name}e()},t.onerror=function(){},t.send()})];case 1:return s.sent(),[2,i]}})})},u([Object(o.ViewChild)(i.f),g("design:type",i.f)],e.prototype,"content",void 0),u([Object(o.ViewChild)("chat_input"),g("design:type",o.ElementRef)],e.prototype,"messageInput",void 0),u([Object(o.Input)(),g("design:type",Object)],e.prototype,"conversation",void 0),e=u([Object(o.Component)({selector:"page-conversation",template:'<ion-header>\n\n  <ion-navbar>\n    <ion-title>\n      <span *ngFor="let chatUser of conversation?.users">\n        <span *ngIf="chatUser?.username !== user?.username" (click)="viewProfile(chatUser)">\n          <img class="user-img" [src]="chatUser?.thumb || \'assets/imgs/nopic-profile.png\'" onerror="this.src = \'assets/imgs/nopic-profile.png\'" width="25px" height="25px" style="vertical-align: middle; border-radius: 50%;">\n          {{chatUser?.firstName || chatUser?.username}} <span *ngIf="chatUser?.firstName">{{chatUser?.lastName}}</span>\n        </span>\n      </span>\n    </ion-title>\n    \x3c!--<ion-fab style="top: 0px;" top right #fab>--\x3e\n      \x3c!--<button ion-fab mini>--\x3e\n        \x3c!--<ion-icon name="add" role="img" class="icon icon-ios ion-ios-add" aria-label="add"></ion-icon>--\x3e\n      \x3c!--</button>--\x3e\n      \x3c!--<ion-fab-list side="left">--\x3e\n        \x3c!--<button ion-button (click)="addByContacts(fab)">--\x3e\n          \x3c!--Contacts <ion-icon name="contacts" style="padding-left: 5px;"></ion-icon>--\x3e\n        \x3c!--</button>--\x3e\n        \x3c!--<button ion-button (click)="addByUsername(fab)">--\x3e\n          \x3c!--Username <ion-icon name="person-add" style="padding-left: 5px;"></ion-icon>--\x3e\n        \x3c!--</button>--\x3e\n      \x3c!--</ion-fab-list>--\x3e\n    \x3c!--</ion-fab>--\x3e\n  </ion-navbar>\n\n</ion-header>\n\n<ion-content (ionScroll)="didScroll($event)">\n\n  <div class="message-wrap">\n\n    <div *ngIf="!msgList || !msgList.length">\n      <br>\n      <br>\n      <br>\n      <h4 text-center>No messages yet</h4>\n    </div>\n\n    <div *ngIf="hasLoadedMessages">\n      <div *ngFor="let msg of msgList" class="message" [class.left]=" msg?.sentBy !== user.$id " [class.right]=" msg?.sentBy === user.$id" lazy-load-images>\n        <img class="user-img" [src]="msg.thumb || \'assets/imgs/nopic-profile.png\'" onerror="this.src = \'assets/imgs/nopic-profile.png\'" (click)="viewProfile({$id: msg?.sentBy})">\n        <div class="msg-detail">\n          <div class="msg-content">\n            <span class="triangle"></span>\n            <img *ngIf="msg?.mediaUrl && hasScrolled" [attr.data-src]="msg?.mediaUrl || \'\'" (press)="copyText(msg?.mediaUrl)" imageViewer />\n            <p class="line-breaker ">\n              \x3c!--{{msg?.message[user.language]}}--\x3e\n              <span [innerHTML]="msg?.message[user.language] | linky" (press)="copyText(msg?.message[user.language])"></span>\n            </p>\n            <div *ngIf="msg?.meta?.link" class="meta-link" (click)="openLink(msg?.meta?.link?.rawUrl)">\n              <div style="width: 100px; float: left;">\n                <img id="icon" style="width: 90px;" src="{{msg?.meta?.link?.icon}}" />\n              </div>\n              <h3>{{msg?.meta?.link?.title  || \'---------\'}}</h3>\n              <h6>{{msg?.meta?.link?.rawUrl}}</h6>\n              <span>{{msg?.meta?.link?.description || \'--------------------\'}}</span>\n            </div>\n          </div>\n\n          \x3c!--<div class="msg-info">--\x3e\n            \x3c!--<p>--\x3e\n              \x3c!--{{msg?.username}}&nbsp;&nbsp;{{msg?.time | relativeTime}}</p>--\x3e\n          \x3c!--</div>--\x3e\n        </div>\n      </div>\n      <h6 style="color: rgba(150, 150, 150, 0.8); font-size: 0.8em;" *ngIf="msgList.length">\n        Read by\n        <span *ngFor="let id of objectKeys(conversation?.readBy || {})" style="margin-right: 5px;">\n          {{conversation?.readBy[id]}}\n          <span *ngIf="conversation?.typing && conversation?.typing[id] && id !== profile?.$id">is typing...</span>\n        </span>\n      </h6>\n    </div>\n\n  </div>\n\n  <input type="text" id="copy-container" style="position: fixed; left: -50px; opacity: 0;" />\n\n</ion-content>\n\n<ion-footer no-border [style.height]="showEmojiPicker ? \'255px\' : \'55px\'">\n  <div class="input-wrap" style="padding-left: 0px;">\n    \x3c!--<button ion-button clear icon-only item-right (click)="switchEmojiPicker()">--\x3e\n      \x3c!--<ion-icon name="md-happy"></ion-icon>--\x3e\n    \x3c!--</button>--\x3e\n    <button ion-button clear icon-only item-right (click)="presentActionSheet()" *ngIf="!isBrowser">\n    <ion-icon name="md-image"></ion-icon>\n    </button>\n    <textarea autosize #chat_input id="message-entry" placeholder="Text Input" [(ngModel)]="editorMsg" (ngModelChange)="isTyping($event)" (keyup.enter)="sendMsg()" (focusin)="onFocus()">\n    </textarea>\n    <button ion-button clear icon-only item-right (click)="sendMsg()">\n      <ion-icon name="ios-send" ios="ios-send" md="md-send"></ion-icon>\n    </button>\n  </div>\n  \x3c!--<emoji-picker [(ngModel)]="editorMsg"></emoji-picker>--\x3e\n</ion-footer>\n'}),g("design:paramtypes",[i.r,i.s,s.a,o.NgZone,i.q,i.b,i.w,i.p,l.a,i.a,i.u,A.a])],e)}()},59:function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),i=n(9),s=n(243),a=n(136),r=n(32),c=(n.n(r),n(40)),l=n(26),A=(n.n(l),this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}),u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,i,s,a,r){var c=this;this.navCtrl=e,this.navParams=t,this.modalCtrl=n,this.ngZone=o,this.alertCtrl=i,this.viewCtrl=s,this.http=a,this.loadingCtrl=r,this.viewingSomeone=!1,this.browser=!1;var A=this.navParams.get("profile");A?(this.viewingSomeone=!0,l.firestore().collection("users").doc(A.$id).get().then(function(e){c.user=e.data(),c.loadUserInfo()})):(this.user=JSON.parse(localStorage.getItem("user")),this.loadUserInfo()),this.browser=!!JSON.parse(localStorage.getItem("isBrowser"))}return e.prototype.loadUserInfo=function(){var e=this;this.user.thumb||(this.user.thumb="assets/imgs/nopic-profile.png"),this.getLanguage().subscribe(function(t){e.langList=t,e.formatLanguage()})},e.prototype.editProfile=function(){var e=this,t=this.modalCtrl.create(s.a);t.onDidDismiss(function(t){e.user=JSON.parse(localStorage.getItem("user")),e.formatLanguage()}),t.present()},e.prototype.logout=function(){var e=this;this.alertCtrl.create({title:"Are you sure?",buttons:[{text:"Cancel",handler:function(e){}},{text:"Yes",handler:function(t){localStorage.removeItem("user"),e.ngZone.run(function(){e.navCtrl.setRoot(a.a);e.loadingCtrl.create({content:"Please wait..."}).present(),window.location.reload()})}}]}).present()},e.prototype.getLanguage=function(){return this.http.get("./assets/language/language.json").pipe(Object(r.map)(function(e){return e.array}))},e.prototype.formatLanguage=function(){var e=this;this.langList.forEach(function(t){e.user.language===t.code&&(e.language=t.name)})},e=A([Object(o.Component)({selector:"page-contact",template:'<ion-header>\n\n  <ion-navbar>\n\n    <ion-buttons left *ngIf="browser">\n\n      <button ion-button icon-only (click)="viewCtrl.dismiss()">\n\n        <ion-icon name="arrow-back"></ion-icon>\n\n      </button>\n\n    </ion-buttons>\n\n    <ion-title>\n\n      Profile\n\n      <span *ngIf="browser">*Editing profile on browser coming soon</span>\n\n    </ion-title>\n\n    <ion-buttons *ngIf="!viewingSomeone && !browser" end>\n\n      <button ion-button (click)="editProfile()">Edit</button>\n\n    </ion-buttons>\n\n  </ion-navbar>\n\n</ion-header>\n\n\n\n<ion-content padding>\n\n\n\n  <div style="display: block; margin: 0px auto;">\n\n    <span style="display: block; width: 100%; height: 175px; text-align: center; margin: 20px 0px 0px;">\n\n      <img [src]="user.thumb" imageViewer *ngIf="user && user.thumb" height="150px" width="150px" style="margin: 0px auto; display: inline-block;" />\n\n      <qr-code [value]="user?.$id" [size]="150"></qr-code>\n\n      \x3c!--<b>Temp Chat ID:</b>--\x3e\n\n    </span>\n\n\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>Username</ion-label>\n\n      <ion-label>{{user?.username || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>Phone</ion-label>\n\n      <ion-label>{{user?.fullPhone || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>Email</ion-label>\n\n      <ion-label>{{user?.email || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>First Name</ion-label>\n\n      <ion-label>{{user?.firstName || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>Last Name</ion-label>\n\n      <ion-label>{{user?.lastName || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <ion-item>\n\n      <ion-label>Current Language</ion-label>\n\n      <ion-label>{{language || \'Not Set\'}}</ion-label>\n\n    </ion-item>\n\n    <br>\n\n    <p *ngIf="!viewingSomeone" (click)="logout()" style="text-align: center; color: #91AAE6;">\n\n      Sign Out\n\n    </p>\n\n  </div>\n\n</ion-content>\n\n'}),u("design:paramtypes",[i.r,i.s,i.q,o.NgZone,i.b,i.y,c.a,i.p])],e)}()},60:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),i=n(9),s=n(244),a=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n,o,i,s){this.navCtrl=e,this.navParams=t,this.viewCtrl=n,this.contacts=o,this.ngZone=i,this.loadingCtrl=s,this.allContacts=[],this.getContacts()}return e.prototype.ionViewDidLoad=function(){console.log("ionViewDidLoad ModalContactPage")},e.prototype.closeModal=function(){this.viewCtrl.dismiss()},e.prototype.selectContact=function(e){this.viewCtrl.dismiss(e.split(/[^0-9]+/).join(""))},e.prototype.capitalizeFirstLetter=function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):null},e.prototype.getContacts=function(){var e=this,t=this.loadingCtrl.create({content:"Loading contacts..."});t.present(),this.contacts.find(["displayName","name","phoneNumbers"],{filter:"",multiple:!0}).then(function(n){var o=[];n.forEach(function(t){o.push({name:e.capitalizeFirstLetter(t.displayName)||"Name not found",phone:t.phoneNumbers&&t.phoneNumbers[0].value?t.phoneNumbers[0].value:"Number not found"})}),o.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),e.ngZone.run(function(){e.allContacts=o,t.dismiss()})})},e=a([Object(o.Component)({selector:"page-modal-contact",template:'\x3c!--\n  Generated template for the ModalContactPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n<ion-header>\n\n  <ion-navbar>\n    <ion-buttons start>\n      <button ion-button (click)="closeModal()">Close</button>\n    </ion-buttons>\n    <ion-title>Select Contact</ion-title>\n  </ion-navbar>\n</ion-header>\n\n<ion-content padding>\n  <div style="height:100%">\n    <ion-list [virtualScroll]="allContacts" approxItemHeight="50px">\n\n      <ion-item *virtualItem="let o" (click)="selectContact(o.phone)">\n        {{ o.name }} - {{ o.phone }}\n      </ion-item>\n    </ion-list>\n  </div>\n</ion-content>\n'}),r("design:paramtypes",[i.r,i.s,i.y,s.a,o.NgZone,i.p])],e)}()},73:function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),i=n(9),s=n(247),a=n(40),r=n(26),c=(n.n(r),n(59)),l=n(60),A=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,i,s,a,c,l,A){var u=this;this.navCtrl=e,this.navParams=t,this.chatService=n,this.events=o,this.http=i,this.ngZone=s,this.modalCtrl=a,this.alertCtrl=c,this.toastCtrl=l,this.loadingCtrl=A,this.msgList=[],this.editorMsg="",this.showEmojiPicker=!1,this.hasLoadedMessages=!1,this.readBy=[],this.user=JSON.parse(localStorage.getItem("user")),this.conversation=this.navParams.get("conversation"),r.firestore().collection("tempConversations").doc(this.conversation.$id).onSnapshot(function(e){if(u.conversation=e.data(),u.conversation){var t=!1;u.conversation.languages.forEach(function(e){e==u.user.language&&(t=!0)}),t||(u.conversation.languages.push(u.user.language),u.http.get("https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+u.user.language+"&q="+u.conversation.lastMessage.message[u.conversation.lastMessage.translatedFrom]+"&format=text").toPromise().then(function(e){u.conversation.lastMessage.message[u.user.language]=e.data.translations[0].translatedText,r.firestore().collection("tempConversations").doc(u.conversation.$id).update(u.conversation)})),u.readBy=[];Object.keys(u.conversation.readBy).forEach(function(e){u.readBy.push(u.conversation.readBy[e])})}})}return e.prototype.ionViewDidLoad=function(){console.log("ionViewDidLoad ConversationPage"),this.getMsg()},e.prototype.ionViewWillLeave=function(){r.firestore().collection("users").doc(this.user.$id).collection("tempConversations").doc(this.conversation.$id).delete()},e.prototype.ionViewDidEnter=function(){},e.prototype.onFocus=function(){this.showEmojiPicker=!1,this.content.resize(),this.scrollToBottom()},e.prototype.switchEmojiPicker=function(){this.showEmojiPicker=!this.showEmojiPicker,this.showEmojiPicker?this.setTextareaScroll():this.focus(),this.content.resize(),this.scrollToBottom()},e.prototype.getMsg=function(){var e=this;r.firestore().collection("tempConversations").doc(this.conversation.$id).collection("messages").onSnapshot(function(t){t.docChanges().forEach(function(t){if("added"===t.type){var n=t.doc.data();n.message[e.user.language]?e.ngZone.run(function(){e.msgList.push(t.doc.data()),setTimeout(function(){e.scrollToBottom()},200)}):e.http.get("https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+e.user.language+"&q="+n.message[n.translatedFrom]+"&format=text").toPromise().then(function(o){n.message[e.user.language]=o.data.translations[0].translatedText,r.firestore().collection("tempConversations").doc(e.conversation.$id).collection("messages").doc(t.doc.id).update(n),e.ngZone.run(function(){e.msgList.push(n),setTimeout(function(){e.scrollToBottom()},200)})},function(o){e.http.get("https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+e.user.language+"&q="+n.message[n.translatedFrom]+"&format=text").toPromise().then(function(o){n.message[e.user.language]=o.data.translations[0].translatedText,r.firestore().collection("tempConversations").doc(e.conversation.$id).collection("messages").doc(t.doc.id).update(n),e.ngZone.run(function(){e.msgList.push(n),setTimeout(function(){e.scrollToBottom()},200)})},function(e){})})}}),e.hasLoadedMessages||(e.hasLoadedMessages=!0),e.conversation.readBy[e.user.$id]=e.user.username,r.firestore().collection("tempConversations").doc(e.conversation.$id).update({readBy:e.conversation.readBy})})},e.prototype.sendMsg=function(){var e=this;if(this.editorMsg.trim()){this.editorMsg=this.editorMsg.replace("↵","");var t=this.navParams.get("conversation"),n={$id:r.firestore().collection("tempConversations").doc(t.$id).collection("messages").doc().id,sentBy:this.user.$id,username:this.user.username,firstName:this.user.firstName||"",lastName:this.user.lastName||"",translatedFrom:this.user.language,thumb:this.user.thumb||"",time:Date.now(),message:{}},o=[];this.conversation.languages.forEach(function(t){var i=new Promise(function(o,i){var s="https://www.googleapis.com/language/translate/v2?key=AIzaSyDI8IMTkk6Qdp7z7Ez-yvkRQH3V4gE0Xkk&target="+t+"&q="+e.editorMsg+"&format=text";e.http.get(s).toPromise().then(function(e){n.message[t]=e.data.translations[0].translatedText,o()},function(i){e.http.get(s).toPromise().then(function(e){n.message[t]=e.data.translations[0].translatedText,o()},function(e){})})});o.push(i)});var i=[];this.conversation.users.forEach(function(t){if(t.$id!==e.user.$id){var n=new Promise(function(e,n){r.firestore().collection("users").doc(t.$id).get().then(function(t){t.data().token&&i.push(t.data().token),e()}).catch(function(){e()})});o.push(n)}}),n.message[this.user.language]=this.editorMsg,this.editorMsg="",this.showEmojiPicker||this.focus();var s={};if(this.conversation.readBy){Object.keys(this.conversation.readBy).forEach(function(e){s[e]=""})}s[this.user.$id]=this.user.username,this.conversation.readBy=s,Promise.all(o).then(function(o){r.firestore().collection("tempConversations").doc(t.$id).collection("messages").doc(n.$id).set(n),r.firestore().collection("tempConversations").doc(t.$id).update({lastMessage:n,readBy:s,lastUpdated:Date.now()});e.http.post("https://us-central1-letstalk-205602.cloudfunctions.net/sendMessage",{tokens:i}).toPromise().then(function(e){}).catch(function(e){console.log(e)})}),this.scrollToBottom()}},e.prototype.pushNewMsg=function(e){},e.prototype.addByUsername=function(e){var t=this;e.close();this.alertCtrl.create({title:"Start a conversation",inputs:[{name:"username",placeholder:"Enter Username"}],buttons:[{text:"Cancel",role:"cancel",handler:function(){console.log("Cancel clicked")}},{text:"Add",handler:function(e){if(e.username)if(e.username!=t.user.username)r.firestore().collection("users").where("username","==",e.username.toLowerCase()).get().then(function(e){if(!e.docs.length){t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}e.forEach(function(e){if(e.data())t.addUser(e.data());else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})});else{t.toastCtrl.create({message:"You cannot invite yourself.",duration:3e3,position:"bottom"}).present()}}}]}).present()},e.prototype.addByContacts=function(e){var t=this;e.close();var n=this.modalCtrl.create(l.a);n.onDidDismiss(function(e){if(e){if(e==t.user.phone){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}var n=t.loadingCtrl.create({content:"Searching for user..."});n.present();var o=[],i=[new Promise(function(t,n){r.firestore().collection("users").where("fullPhone","==","+"+e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})}),new Promise(function(t,n){r.firestore().collection("users").where("phone","==",e).get().then(function(e){e.forEach(function(e){o.push(e)}),t()})})];Promise.all(i).then(function(e){if(n.dismiss(),o.length)o.forEach(function(e){if(e.data()){if(e.data().username==t.user.username){return void t.toastCtrl.create({message:"You cannot start a chat with yourself.",duration:3e3,position:"bottom"}).present()}t.addUser(e.data())}else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}});else{t.toastCtrl.create({message:"User not found.",duration:3e3,position:"bottom"}).present()}})}}),n.present()},e.prototype.addUser=function(e){r.firestore().collection("users").doc(this.user.$id).collection("tempConversations").doc(this.conversation.$id).set({chatId:this.conversation.$id}),this.conversation.users.push({$id:e.$id,language:e.language,username:e.username,firstName:e.firstName||"",lastName:e.lastName||""});var t=!1;this.conversation.languages.forEach(function(n){n==e.language&&(t=!0)}),t||this.conversation.languages.push(e.language),r.firestore().collection("tempConversations").doc(this.conversation.$id).update(this.conversation)},e.prototype.getMsgIndexById=function(e){return this.msgList.findIndex(function(t){return t.messageId===e})},e.prototype.viewProfile=function(e){this.navCtrl.push(c.a,{profile:e})},e.prototype.scrollToBottom=function(){this.content._scroll&&this.content.scrollToBottom()},e.prototype.focus=function(){this.messageInput&&this.messageInput.nativeElement&&this.messageInput.nativeElement.focus()},e.prototype.setTextareaScroll=function(){var e=this.messageInput.nativeElement;e.scrollTop=e.scrollHeight},A([Object(o.ViewChild)(i.f),u("design:type",i.f)],e.prototype,"content",void 0),A([Object(o.ViewChild)("chat_input"),u("design:type",o.ElementRef)],e.prototype,"messageInput",void 0),e=A([Object(o.Component)({selector:"page-temp-conversation",template:'<ion-header>\n\n  <ion-navbar>\n    <ion-title>\n      <span *ngFor="let chatUser of conversation?.users">\n        <span *ngIf="chatUser?.username !== user?.username" (click)="viewProfile(chatUser)">\n          {{chatUser?.username}}\n        </span>\n      </span>\n    </ion-title>\n    \x3c!--<ion-fab style="top: 0px;" top right #fab>--\x3e\n      \x3c!--<button ion-fab mini>--\x3e\n        \x3c!--<ion-icon name="add" role="img" class="icon icon-ios ion-ios-add" aria-label="add"></ion-icon>--\x3e\n      \x3c!--</button>--\x3e\n      \x3c!--<ion-fab-list side="left">--\x3e\n        \x3c!--<button ion-button (click)="addByContacts(fab)">--\x3e\n          \x3c!--Contacts <ion-icon name="contacts" style="padding-left: 5px;"></ion-icon>--\x3e\n        \x3c!--</button>--\x3e\n        \x3c!--<button ion-button (click)="addByUsername(fab)">--\x3e\n          \x3c!--Username <ion-icon name="person-add" style="padding-left: 5px;"></ion-icon>--\x3e\n        \x3c!--</button>--\x3e\n      \x3c!--</ion-fab-list>--\x3e\n    \x3c!--</ion-fab>--\x3e\n  </ion-navbar>\n\n</ion-header>\n\n<ion-content>\n\n  <div class="message-wrap">\n\n    <div *ngIf="!msgList || !msgList.length">\n      <br>\n      <br>\n      <br>\n      <h4 text-center>No messages yet</h4>\n    </div>\n\n    <div *ngIf="hasLoadedMessages">\n      <div *ngFor="let msg of msgList | sortByTime" class="message" [class.left]=" msg?.sentBy !== user.$id " [class.right]=" msg?.sentBy === user.$id">\n        <img class="user-img" [src]="msg.thumb || \'assets/imgs/nopic-profile.png\'" imageViewer onerror="this.src = \'assets/imgs/nopic-profile.png\'">\n        <div class="msg-detail">\n          <div class="msg-content">\n            <span class="triangle"></span>\n            <p class="line-breaker ">{{msg?.message[user.language]}}</p>\n          </div>\n          \x3c!--<div class="msg-info">--\x3e\n            \x3c!--<p>--\x3e\n              \x3c!--{{msg?.username}}&nbsp;&nbsp;{{msg?.time | relativeTime}}</p>--\x3e\n          \x3c!--</div>--\x3e\n        </div>\n      </div>\n      <h6 style="color: rgba(150, 150, 150, 0.8); font-size: 0.8em;" *ngIf="msgList.length">\n        Read by <span *ngFor="let username of readBy" style="margin-right: 5px;">{{username}}</span>\n      </h6>\n    </div>\n\n  </div>\n\n</ion-content>\n\n<ion-footer no-border [style.height]="showEmojiPicker ? \'255px\' : \'55px\'">\n  <div class="input-wrap">\n    \x3c!--<button ion-button clear icon-only item-right (click)="switchEmojiPicker()">--\x3e\n      \x3c!--<ion-icon name="md-happy"></ion-icon>--\x3e\n    \x3c!--</button>--\x3e\n    <textarea #chat_input placeholder="Text Input" [(ngModel)]="editorMsg" (keyup.enter)="sendMsg()" (focusin)="onFocus()">\n    </textarea>\n    <button ion-button clear icon-only item-right (click)="sendMsg()">\n      <ion-icon name="ios-send" ios="ios-send" md="md-send"></ion-icon>\n    </button>\n  </div>\n  \x3c!--<emoji-picker [(ngModel)]="editorMsg"></emoji-picker>--\x3e\n</ion-footer>\n'}),u("design:paramtypes",[i.r,i.s,s.a,i.i,a.a,o.NgZone,i.q,i.b,i.w,i.p])],e)}()}},[274]);